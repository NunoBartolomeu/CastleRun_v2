<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Castle Run - Map Visualizer</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>üè∞ Castle Run - Map Visualizer</h1>
  </header>
  
  <main>
    <div id="canvas-container">
      <canvas id="canvas"></canvas>
    </div>
    
    <aside id="controls-panel">
      <!-- MODULE SELECTOR -->
      <div class="section">
        <h2>Module</h2>
        <div class="module-tabs">
          <button class="module-tab active" data-module="module1">
            ‚õèÔ∏è Module 1
          </button>
          <button class="module-tab" data-module="module2-1">
            üåç Module 2.1
          </button>
          <button class="module-tab" data-module="module2-2">
            üö™ Module 2.2
          </button>
        </div>
      </div>
      
      <!-- CONFIGURATION -->
      <div class="section">
        <h2>Configuration</h2>
        
        <!-- Module 1 Config -->
        <div id="config-module1" class="config-panel active">
          <div class="config-grid">
            <div class="input-group">
              <label>Width</label>
              <input type="number" id="m1-width" value="50" min="7" max="1000">
            </div>
            <div class="input-group">
              <label>Height</label>
              <input type="number" id="m1-height" value="50" min="7" max="1000">
            </div>
            <div class="input-group">
              <label>Target %</label>
              <input type="number" id="m1-target" value="50" min="1" max="70">
            </div>
            <div class="input-group">
              <label>Seed</label>
              <input type="number" id="m1-seed" value="12345">
            </div>
            <div class="input-group">
              <label>Break Weight</label>
              <input type="number" id="m1-breakWeight" value="5" min="1">
            </div>
            <div class="input-group">
              <label>Backtrack Weight</label>
              <input type="number" id="m1-backtrackWeight" value="1" min="1">
            </div>
            <div class="input-group">
              <label>Sections X</label>
              <input type="number" id="m1-sectionsX" value="1" min="1" max="20">
            </div>
            <div class="input-group">
              <label>Sections Y</label>
              <input type="number" id="m1-sectionsY" value="1" min="1" max="20">
            </div>
            <div class="input-group full-width">
              <label>
                <input type="checkbox" id="m1-applyVoid">
                Apply VOID to edges
              </label>
            </div>
          </div>
          <button id="generate-module1" class="btn-primary">Generate Map</button>
        </div>
        
        <!-- Module 2.1 Config -->
        <div id="config-module2-1" class="config-panel">
          <div class="info-box">
            ‚ÑπÔ∏è Load a Module 1 map first, or generate one in Module 1 tab
          </div>
          
          <div id="biome-list">
            <h3>Biomes</h3>
            <div id="biome-entries"></div>
            <button id="add-biome" class="btn-secondary">+ Add Biome</button>
          </div>
          
          <div class="config-grid">
            <div class="input-group">
              <label>Floor Conversion %</label>
              <input type="number" id="m2-floorChance" value="75" min="0" max="100">
            </div>
            <div class="input-group">
              <label>Wall Conversion %</label>
              <input type="number" id="m2-wallChance" value="50" min="0" max="100">
            </div>
            <div class="input-group full-width">
              <label>Expansion Mode</label>
              <select id="m2-expansionMode">
                <option value="CARDINAL">Cardinal (N,S,E,W)</option>
                <option value="ALL">All Directions (8-way)</option>
              </select>
            </div>
            <div class="input-group full-width">
              <label>Seed</label>
              <input type="number" id="m2-seed" value="67890">
            </div>
          </div>
          
          <button id="generate-module2-1" class="btn-primary">Assign Biomes</button>
        </div>

        <!-- Module 2.2 Config (NEW) -->
        <div id="config-module2-2" class="config-panel">
          <div class="info-box">
            ‚ÑπÔ∏è Load a Module 2.1 map first, or generate biomes in Module 2.1 tab
          </div>
          
          <div class="config-grid">
            <div class="input-group">
              <label>Entry Count</label>
              <input type="number" id="m22-entryCount" value="4" min="1" max="20">
            </div>
            <div class="input-group">
              <label>Exit Count</label>
              <input type="number" id="m22-exitCount" value="3" min="1" max="20">
            </div>
            <div class="input-group">
              <label>Key Count</label>
              <input type="number" id="m22-keyCount" value="5" min="1" max="50">
            </div>
            <div class="input-group">
              <label>Seed</label>
              <input type="number" id="m22-seed" value="99999">
            </div>
          </div>
          
          <button id="generate-module2-2" class="btn-primary">Place Spawn Points</button>
        </div>
      </div>
      
      <!-- VISUALIZER CONTROLS -->
      <div class="section" id="visualizer-section" style="display: none;">
        <h2>Visualizer</h2>
        
        <!-- Module 1 Controls -->
        <div id="controls-module1" class="controls-panel">
          <div class="step-info">
            <div>Step: <span id="m1-current-step">0</span> / <span id="m1-total-steps">0</span></div>
            <div>Action: <span id="m1-current-action">-</span></div>
            <div>Position: <span id="m1-current-position">-</span></div>
          </div>
          
          <div class="controls-grid">
            <button id="m1-zoom-out" class="btn-icon">üîç-</button>
            <button id="m1-zoom-in" class="btn-icon">üîç+</button>
            <button id="m1-first">‚èÆ First</button>
            <button id="m1-last">‚è≠ Last</button>
            <button id="m1-prev-break">‚è™ Prev Break</button>
            <button id="m1-next-break">‚è© Next Break</button>
            <button id="m1-prev">‚óÄ Prev</button>
            <button id="m1-next">‚ñ∂ Next</button>
            <button id="m1-play">‚ñ∂ Play</button>
            <button id="m1-reset">üîÑ Reset</button>
          </div>
        </div>
        
        <!-- Module 2.1 Controls -->
        <div id="controls-module2-1" class="controls-panel">
          <div class="step-info">
            <div>Cycle: <span id="m2-current-cycle">0</span> / <span id="m2-total-cycles">0</span></div>
            <div>Step: <span id="m2-current-step">0</span> / <span id="m2-total-steps">0</span></div>
            <div>Action: <span id="m2-current-action">-</span></div>
            <div>Biome: <span id="m2-current-biome">-</span></div>
            <div>Position: <span id="m2-current-position">-</span></div>
          </div>
          
          <div class="controls-grid">
            <button id="m2-zoom-out" class="btn-icon">üîç-</button>
            <button id="m2-zoom-in" class="btn-icon">üîç+</button>
            <button id="m2-prev-cycle">‚è™ Prev Cycle</button>
            <button id="m2-next-cycle">‚è© Next Cycle</button>
            <button id="m2-prev-step">‚óÄ Prev Step</button>
            <button id="m2-next-step">‚ñ∂ Next Step</button>
            <button id="m2-play">‚ñ∂ Play</button>
            <button id="m2-show-final">üèÅ Final</button>
          </div>
        </div>

        <!-- Module 2.2 Controls (NEW) -->
        <div id="controls-module2-2" class="controls-panel">
          <div class="controls-grid">
            <button id="m22-zoom-out" class="btn-icon">üîç-</button>
            <button id="m22-zoom-in" class="btn-icon">üîç+</button>
          </div>
        </div>
      </div>
      
      <!-- LEGEND -->
      <div class="section">
        <h2>Legend</h2>
        
        <!-- Module 1 Legend -->
        <div id="legend-module1" class="legend-panel">
          <div class="legend-item">
            <div class="legend-color" style="background: #8b4513;"></div>
            <span>Wall</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #f0f0f0;"></div>
            <span>Floor</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #000;"></div>
            <span>Void</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #3b82f6;"></div>
            <span>Miner</span>
          </div>
        </div>
        
        <!-- Module 2.1 Legend (dynamic) -->
        <div id="legend-module2-1" class="legend-panel">
          <div id="biome-legend"></div>
        </div>

        <!-- Module 2.2 Legend (NEW) -->
        <div id="legend-module2-2" class="legend-panel">
          <div class="legend-item">
            <div class="legend-color" style="background: #22c55e;"></div>
            <span>Entry</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #ef4444;"></div>
            <span>Exit</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #eab308;"></div>
            <span>Key</span>
          </div>
        </div>
      </div>
      
      <!-- STATISTICS -->
      <div class="section" id="stats-section" style="display: none;">
        <h2>Statistics</h2>
        
        <!-- Module 1 Stats -->
        <div id="stats-module1" class="stats-panel"></div>
        
        <!-- Module 2.1 Stats -->
        <div id="stats-module2-1" class="stats-panel"></div>

        <!-- Module 2.2 Stats (NEW) -->
        <div id="stats-module2-2" class="stats-panel"></div>
      </div>
      
      <!-- SAVE/LOAD -->
      <div class="section">
        <h2>Save / Load</h2>
        <button id="save-map" class="btn-secondary">üíæ Save Full</button>
        <button id="save-compact" class="btn-secondary">üì¶ Save Compact</button>
        <button id="load-map" class="btn-secondary">üìÇ Load Map</button>
        <input type="file" id="file-input" accept=".json" style="display: none;">
      </div>
    </aside>
  </main>
  
  <script type="module" src="app.js"></script>
</body>
</html>